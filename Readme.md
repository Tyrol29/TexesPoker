# 德州扑克对战游戏 (TexesPoker)

[![Python 3.7+](https://img.shields.io/badge/python-3.7+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

一个功能完整的命令行德州扑克游戏，支持2-8人同时对战，包含智能AI对手、详细数据统计和锦标赛模式。

**⭐ 新特性**: 完美兼容所有 Windows 版本，支持彩色/无颜色双模式显示！

![游戏截图](screenshot.png)

## 功能特性

- ✅ **多人对战**: 支持2-8人游戏（人类+AI混合）
- ✅ **智能AI对手**: 4种不同打法风格（紧凶/松凶/紧弱/松弱）
- ✅ **蒙特卡洛胜率计算**: AI使用1000次模拟估算胜率
- ✅ **完整德州规则**: 翻牌前、翻牌、转牌、河牌四个下注轮次
- ✅ **手牌评估**: 完整的牌型判断（皇家同花顺到高牌）
- ✅ **底池管理**: 主池、边池、全押处理
- ✅ **详细统计**: 100手牌后输出技术指标报告
- ✅ **锦标赛模式**: 第一个电脑被淘汰后盲注翻倍
- ✅ **4色牌面**: 红心♥红色、方块♦黄色、梅花♣绿色、黑桃♠青色
- ✅ **智能下注**: 基于底池比例的下注尺度
- ✅ **偏离分析**: 统计报告分析实际打法与预设风格的偏离
- ✅ **跨平台兼容**: 完美支持 Windows 7/10/11，自动适配颜色显示
- ✅ **游戏存档**: 支持3个存档槽位，随时保存/加载游戏进度

## 快速开始

### 方式一：直接运行可执行文件（推荐）

下载 `德州扑克.exe` 文件，双击即可运行，无需安装 Python。

**支持的环境**:
- Windows 11 - 显示彩色牌面
- Windows 10 - 显示彩色牌面
- Windows 7/旧版 Windows - 显示字母标识（H/D/C/S）

### 方式二：从源码运行

#### 安装要求
- Python 3.7+

#### 运行游戏

```bash
# 克隆仓库
git clone https://github.com/Tyrol29/TexesPoker.git
cd TexesPoker

# 运行游戏
cd texas_holdem
python main.py
```

#### 打包成可执行文件

```bash
# 安装 PyInstaller
pip install pyinstaller

# 打包
pyinstaller 德州扑克.spec

# 可执行文件位于 dist/德州扑克.exe
```

### 游戏设置
1. 选择玩家人数（2-8人）
2. 选择AI数量（1到玩家数-1）
3. 输入你的名称
4. 电脑随机分配打法风格（显示在名称中，如`电脑1号[紧凶]`）

### 游戏命令

| 输入 | 行动 |
|------|------|
| `f` 或 `fold` | 弃牌 |
| `c` 或 `call` | 跟注 |
| `k` 或 `check` | 过牌（不下注）|
| `r [金额]` 或 `raise [金额]` | 加注 |
| `a` 或 `allin` | 全押 |
| `s` 或 `save` | 保存游戏 |

### 游戏存档

游戏支持 **3个存档槽位**，可以随时保存和加载游戏进度：

**保存内容：**
- 所有玩家信息（名称、筹码、AI风格）
- 当前游戏状态（手牌数、盲注级别、底池等）
- 详细统计数据（VPIP、PFR、AF等指标）
- 进行中的手牌状态

**如何保存：**
1. 在游戏中随时输入 `save` 或 `s`
2. 每手牌结束后会询问是否保存
3. 选择存档槽位（1-3）

**如何加载：**
1. 在主菜单选择 "2. 继续游戏"
2. 选择要加载的存档
3. 可选择继续当前手牌或放弃重新开始

**存档文件位置：**
```
saves/
├── save_1.json
├── save_2.json
└── save_3.json
```

## 跨平台显示说明

### 彩色模式（Windows 10/11 新终端）

如果你的系统支持 ANSI 颜色，游戏将显示彩色牌面：

```
花色颜色说明:
  A♥ = 红桃A   A♦ = 方块A
  K♣ = 梅花K   K♠ = 黑桃K
```

### 无颜色模式（Windows 7/旧终端）

如果你的系统不支持颜色，游戏将自动切换到字母标识模式：

```
------------------------------------------------------------
花色说明 (无颜色模式):
  H = 红桃 (Hearts)    D = 方块 (Diamonds)
  C = 梅花 (Clubs)     S = 黑桃 (Spades)
  示例: AH = 红桃A     10D = 方块10
------------------------------------------------------------
```

**无需手动设置**，程序会自动检测并切换到合适的显示模式！

## AI打法风格

电脑名称显示打法风格，如`电脑1号[紧凶]`：

| 风格 | 代码 | 特点 | VPIP目标 | AF目标 |
|------|------|------|---------|--------|
| **紧凶** | TAG | 精选手牌，积极加注 | 15-25% | 2.0-4.0 |
| **松凶** | LAG | 多玩手牌，持续施压 | 30-45% | 2.0-4.0 |
| **紧弱** | LAP | 精选手牌，被动跟注 | 15-25% | 0.5-1.5 |
| **松弱** | LP | 多玩手牌，被动跟注 | 35-50% | 0.5-1.5 |

- **VPIP**: 主动入池率（看翻牌的概率）
- **AF**: 激进因子 = (下注+加注次数) / 跟注次数

## 锦标赛模式

**盲注升级规则**: 第一个电脑被淘汰后，盲注翻倍！

```
初始: 小盲10 / 大盲20
升级后: 小盲20 / 大盲40
```

这加快了游戏进程，让比赛更快进入高潮。

## 统计报告

每完成100手牌，系统自动输出详细统计报告：

### 基础指标
- **VPIP%**: 主动入池率
- **PFR%**: 翻牌前加注率  
- **3BET%**: 再加注频率
- **AF**: 激进因子

### 高级指标
- **WTSD%**: 摊牌率（看到对手牌的频率）
- **W$SD%**: 摊牌胜率
- **不摊牌胜%**: 对手弃牌赢得底池的比例
- **弃3BET%**: 面对再加注时的弃牌率
- **偷盲率**: 后位抢盲注频率
- **C-BET%**: 持续下注率
- **诈唬成功率**: 诈唬行动成功率

### 偏离分析
当实际打法与预设风格不符时，报告会显示具体偏离：
```
[偏离分析] 偏紧(VPIP18% < 目标25%); 偏凶(AF3.2 > 目标2.5)
```

## 技术亮点

### 跨平台兼容性
游戏使用 Windows API 自动配置控制台，确保在各类 Windows 版本上正常运行：

```python
def setup_windows_console():
    # 设置 UTF-8 代码页
    kernel32.SetConsoleCP(65001)
    kernel32.SetConsoleOutputCP(65001)
    # 启用 ANSI 颜色支持
    kernel32.SetConsoleMode(handle, mode | ENABLE_VIRTUAL_TERMINAL_PROCESSING)
```

### 自动颜色检测
根据环境自动选择显示模式：
- 支持 ANSI 的环境 → 显示彩色牌面
- 不支持的环境 → 显示字母标识（H/D/C/S）

### 蒙特卡洛胜率计算
AI使用蒙特卡洛模拟（1000次迭代）估算胜率：
```python
# 随机生成剩余牌组合
for _ in range(1000):
    simulated_cards = random.sample(remaining_deck, needed_cards)
    # 比较手牌大小
    if player_hand > opponent_hand:
        wins += 1
win_probability = wins / 1000
```

### 智能下注尺度
基于底池比例的下注：
- 强牌: 75%底池
- 中等牌: 50%底池
- 弱牌: 33%底池或诈唬

### 听牌概率计算
```
翻牌圈: 胜率 ≈ Outs × 4%
转牌圈: 胜率 ≈ Outs × 2%
```

## 项目结构

```
texas_holdem/
├── main.py                    # 程序入口（含控制台初始化）
├── core/                      # 核心扑克实体
│   ├── card.py               # 扑克牌（4色显示，自动兼容）
│   ├── deck.py               # 牌组管理
│   ├── hand.py               # 玩家手牌
│   ├── player.py             # 玩家状态
│   ├── table.py              # 牌桌（公共牌、底池）
│   └── evaluator.py          # 手牌评估器
├── game/                      # 游戏流程控制
│   ├── game_state.py         # 游戏状态管理
│   ├── game_engine.py        # 游戏引擎主循环
│   └── betting.py            # 下注逻辑系统
├── ui/                        # 用户界面
│   └── cli.py                # 命令行交互（含花色说明）
└── utils/                     # 工具函数
    ├── constants.py          # 游戏常量
    └── save_manager.py       # 游戏存档管理
```

**游戏存档文件：**
```
saves/
├── save_1.json               # 存档槽1
├── save_2.json               # 存档槽2
└── save_3.json               # 存档槽3
```

## 游戏示例

### 支持颜色的环境显示

```
============================================================
          德州扑克对战游戏
============================================================

游戏设置:
  - 支持 2-8 人对战 (人机混合)
  - 初始筹码: 4000
  - 小盲注: 10, 大盲注: 20
  - 游戏包含四个下注轮次: 翻牌前、翻牌、转牌、河牌
  - 支持行动: 弃牌、过牌、跟注、下注、加注、全押

------------------------------------------------------------
花色颜色说明:
  A♥ = 红桃A   A♦ = 方块A
  K♣ = 梅花K   K♠ = 黑桃K
------------------------------------------------------------

============================================================
```

### 无颜色环境显示

```
------------------------------------------------------------
花色说明 (无颜色模式):
  H = 红桃 (Hearts)    D = 方块 (Diamonds)
  C = 梅花 (Clubs)     S = 黑桃 (Spades)
  示例: AH = 红桃A     10D = 方块10
------------------------------------------------------------
```

### 游戏进行界面

```
==================================================
第 15 手牌
==================================================

【翻牌前】 底池: $30
  [BB]     电脑1号[紧凶]    3980筹码         [?][?]
  [SB]     电脑2号[松凶]    5218筹码 注:10   [?][?]
  [BTN]    tyrol           5315筹码         8D 3H
-------------------------------------------------------

========================================
底池总额: 50 筹码
========================================

tyrol 的回合
手牌: 8D 3H
筹码: 5315
当前下注额: 20
需要跟注: 20

可用行动: fold, call, raise, all_in
请选择行动: fold
```

## 更新日志

### v1.3.0 (最新)
- ✨ **新增游戏存档功能**：支持3个存档槽位
- ✨ **新增随时保存**：游戏中输入 'save' 即可保存
- ✨ **新增游戏恢复**：继续游戏时保留所有统计数据
- ✨ **新增存档管理**：主菜单显示存档时间和状态

### v1.2.0
- ✨ **新增跨平台兼容性**：完美支持 Windows 7/10/11
- ✨ **新增自动颜色检测**：自动适配彩色/无颜色模式
- ✨ **新增花色说明界面**：启动时显示花色对照表
- ✨ **新增可执行文件打包**：无需 Python 环境即可运行
- 🐛 **修复编码问题**：移除特殊 Unicode 字符，避免乱码
- 🐛 **修复颜色显示问题**：旧版 Windows 也能正常显示

### v1.1.0
- ✨ 新增4种AI打法风格（紧凶/松凶/紧弱/松弱）
- ✨ 新增锦标赛模式（盲注翻倍机制）
- ✨ 新增详细统计报告（含偏离分析）
- ✨ 新增蒙特卡洛胜率计算
- ✨ 新增4色扑克牌显示
- 🐛 修复盲注升级bug
- 🐛 修复大盲注免费看牌时弃牌的问题
- 🐛 修复筹码总额计算错误

### v1.0.0
- 🎉 初始版本发布
- 支持2人对战
- 基础AI对手
- 完整德州规则

## 贡献

欢迎提交Issue和Pull Request！

## 许可证

[MIT License](LICENSE)

---

**注意**: 本项目仅供学习和娱乐，请遵守当地法律法规。
